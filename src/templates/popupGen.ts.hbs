import { readFile, writeFile } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';
import chalk from 'chalk';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const jsFilePath = join(__dirname, 'js', 'vfwindrm_OnHoldPopUp.js');
const htmlFilePath = join(__dirname, 'HTML', 'OnHoldPopUp.html');

console.log(chalk.magentaBright('\nüîÑ Starting script injection process...'));

readFile(jsFilePath, 'utf8', (err, jsContent) => {
  if (err) {
    console.error(chalk.red('‚ùå Error reading the JavaScript file:', err));
    return;
  }

  readFile(htmlFilePath, 'utf8', (err, htmlContent) => {
    if (err) {
      console.error(chalk.red('‚ùå Error reading the HTML file:', err));
      return;
    }

    const scriptTag = `<script>\n${jsContent}\n</script>\n`;
    const scriptTagPattern = /<script>[\s\S]*?<\/script>\n?/g;
    const cleanedHtmlContent = htmlContent.replace(scriptTagPattern, '');
    const updatedHtmlContent = cleanedHtmlContent.replace('</body>', `${scriptTag}</body>`);

    writeFile(htmlFilePath, updatedHtmlContent, 'utf8', (err) => {
      if (err) {
        console.error(chalk.red('‚ùå Error writing the updated HTML file:', err));
        return;
      }
      console.log(chalk.green('‚úÖ Script injected successfully into the HTML file.'));
    });
  });
});